
<html>
<head>
<script src="load.js"></script>
<title>How to Use Bayes</title>

</head>
<body>



<script>
$(function(){
  $("#nav").load("nav.html");
});
</script>


<!--Navigation bar  -->
<div id="nav"></div>


<div class="topnav">
        Longhai Li@University of Saskatchewan <br>             
        <button class="btn"><a href="aboutme.html">About me</a> </button>
        <button class="btn"><a href="grant.html" >Projects</a> </button>
        <button class="btn"><a href="team.html" >Students</a> </button>
        <button class="btn"><a href="publications.html" >Publications</a> </button>
        <button class="btn"><a href="software.html" >Software</a> </button>
        <button class="active"><a href="useBayes.html" >Computing</a></button>

</div>


<div class="main">	

<h2>Computer cluster “Bayes.usask.ca”</h2>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">1.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">How to access “bayes”</span></font></font></p>
<p class="msonormal">Your accounts on bayes have been created. By
default, they use your nsid and password on paws for bayes. You can
change your password with terminal command &quot;passwd&quot; if you
want after you use ssh client (<a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/"><span style="text-decoration: none">Putty</span></a>
on windows, or terminal on mac) to log into bayes.usask.ca. <br/>
<span lang="en-US"><br/>
</span>Use
VPN to access bayes from off-campus. As required by the U of S and
CFI, you can only use bayes on campus. If you need to use bayes from
home, you need to download vpn client: 
</p>
<p class="msonormal"><a href="http://www.usask.ca/ict/services/network-services/vpn/index.php"><span style="text-decoration: none">http://www.usask.ca/ict/services/network-services/vpn/index.php</span></a>&nbsp;
</p>
<p class="msonormal">It may be very slow to use bayes from home
depending on your connection. 
</p>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">2.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">How to use rstudio server on “bayes”</span></font></font></p>
<p lang="en-US">To use R, you can use rstudio server with your
browser, such as chrome, firefox and safari. The url to log into
rstudio on bayes is: 
</p>
<p align="center"><a href="http://rstudio.bayes.usask.ca/"><font size="4" style="font-size: 16pt"><span lang="en-US"><b>http://rstudio.bayes.usask.ca</b></span></font></a></p>
<p lang="en-US">Note: Rstudio is only for developing and testing your
R code. It cannot do parallel computing. 
</p>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">3.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">Basic commands in linux terminal to
manage your files: </span></font></font>
</p>
<p><span lang="en-US">To understand basic linux terminal (shell)
commands, you are recommended to read this webpage:
<br/>
<a href="http://www.comptechdoc.org/os/linux/usersguide/linux_ugbasics.html">http://www.comptechdoc.org/os/linux/usersguide/linux_ugbasics.html
</a></span>
</p>
<p lang="en-US" class="msonormal">You are in terminal if the line
starts with $, which is different from R console that starts a line
with &gt; .</p>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">4.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">File transmission between bayes and
your desktop</span></font></font></p>
<p lang="en-US">SCP is available on bayes. You can use these methods
to upload/download files between bayes and your desktop: 
</p>
<p style="margin-left: 0.83cm; text-indent: -0.64cm"><font face="Wingdings"><span lang="en-US">Ø</span></font><span style="font-variant: normal"><font face="Wingdings"><span lang="en-US">&nbsp;
</span></font></span><span lang="en-US">On all platforms: Rstudio web
interface provides the function to transfer files</span></p>
<p style="margin-left: 0.83cm; text-indent: -0.64cm"><font face="Wingdings"><span lang="en-US">Ø</span></font><span style="font-variant: normal"><font face="Wingdings"><span lang="en-US">&nbsp;
</span></font></span><span lang="en-US">On windows: using <a href="https://winscp.net/eng/download.php">winscp</a>.
</span>
</p>
<p style="margin-left: 0.83cm; text-indent: -0.64cm"><font face="Wingdings"><span lang="en-US">Ø</span></font><span style="font-variant: normal"><font face="Wingdings"><span lang="en-US">&nbsp;
</span></font></span><span lang="en-US">On Mac: mount bayes harddrive
to your Mac file system with these steps:</span></p>
<p style="margin-left: 1.91cm; text-indent: -0.64cm"><span lang="en-US">1.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">Download <a href="https://osxfuse.github.io/">osxfuse
and sshfs</a> and install them</span></p>
<p style="margin-left: 1.91cm; text-indent: -0.64cm"><span lang="en-US">2.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">Download this bash script to your
“home” directory:&nbsp; <a href="useBayes/bayesfiles/.bash_profile">.bash_profile</a></span></p>
<p style="margin-left: 1.91cm; text-indent: -0.64cm"><span lang="en-US">3.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">Log out and log in again</span></p>
<p style="margin-left: 1.91cm; text-indent: -0.64cm"><span lang="en-US">4.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">Create a directory called “bin”
under /home; change its permission with “chmod 755 bin”</span></p>
<p style="margin-left: 1.91cm; text-indent: -0.64cm"><span lang="en-US">5.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span><span lang="en-US">Download the script file
“<a href="useBayes/bayesfiles/mountbayes">mountbayes</a>” into your “bin”</span></p>
<p style="margin-left: 1.91cm; text-indent: -0.64cm"><span lang="en-US">6.
    </span><span lang="en-US"><span lang="en-US">&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">Mount bayes drive of user abc123 with
this command:</span></p>
<p align="center" style="margin-left: 1.9cm; margin-top: 0.21cm; margin-bottom: 0.18cm">
<span lang="en-US">mountbayes</span> <span lang="en-US">abc123</span></p>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">5.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">How to use “bayes” to do
parallel computing with R </span></font></font>
</p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><span lang="en-US">1.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">log in bayes using ssh client (putty
on windows, terminal in linux and mac) with your user and password. </span>
</p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><span lang="en-US">2.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">Upload/create the “test.r” file
(<a href="http://math.usask.ca/~longhai/useBayes/bayesfiles/test.r">http://math.usask.ca/~longhai/useBayes/bayesfiles/test.r</a>)
to a directory, for example ``test'' under your home directory
((which you need to create with </span><span lang="en-US"><b>mkdir</b></span><span lang="en-US">
</span><span lang="en-US"><b>test</b></span><span lang="en-US">)</span></p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><span lang="en-US">3.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">change to test directory from your
home directory ~ in terminal($), type: </span><span lang="en-US"><b>cd
test</b></span><span lang="en-US"> </span>
</p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><span lang="en-US">4.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">Test your R job, say test.r, with
this command: </span>
</p>
<p align="center" style="margin-left: 1.27cm"><font face="Courier"><span lang="en-US">testR</span></font>
<font face="Courier"><span lang="en-US">test.r</span></font></p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><span lang="en-US">5.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang="en-US">If test.r run correctly, and you
want to run test.r simultaneously 100 times, do this: </span>
</p>
<p align="center" style="margin-left: 1.27cm"><font face="Courier"><span lang="en-US">qsubR</span></font>
<font face="Courier"><span lang="en-US">test.r 100 1GB 00:10:00</span></font></p>
<p lang="en-US"><b>Explanation:</b></p>
<p lang="en-US">In R syntax, this command is very much like 
</p>
<p lang="en-US" align="center"><font face="Courier">for (i in 1:100)
{irep &lt;- i; source (“test.r”))}</font></p>
<p align="justify"><span lang="en-US">It creates 100 R jobs by adding
an R expression “</span><font face="Courier"><span lang="en-US">irep</span></font>
<font face="Courier"><span lang="en-US">&lt;- i</span></font>” <span lang="en-US">(for
i = 1, …, 100) to the top of “test.r” then submit the 100
modified “test.r” to the cluster. All the 100 new “test.r”
will be run simultaneously in 100 CPUs. To distinguish the 100 job
outputs, use “</span><font face="Courier"><span lang="en-US">irep</span></font>”
<span lang="en-US">as the identity in each R job. The difference from
an ordinary “for” loop is that the results of each job must be
saved in harddrive and we need to write a function to combine the
results by retrieving the results from harddrive. </span>
</p>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">6.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">Basic commands to control your jobs
on cluster</span></font></font></p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><font face="Wingdings"><span lang="en-US">Ø</span></font><span style="font-variant: normal"><font face="Wingdings"><span lang="en-US">&nbsp;
</span></font></span><span lang="en-US"><b>qstat</b></span><span lang="en-US">:
to monitor status of jobs </span>
</p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><font face="Wingdings"><span lang="en-US">Ø</span></font><span style="font-variant: normal"><font face="Wingdings"><span lang="en-US">&nbsp;
</span></font></span><span lang="en-US"><b>qdel</b></span> <span lang="en-US"><b>100</b></span><span lang="en-US">:
to kill the job with id 100 </span>
</p>
<p style="margin-left: 1.27cm; text-indent: -0.64cm"><font face="Wingdings"><span lang="en-US">Ø</span></font><span style="font-variant: normal"><font face="Wingdings"><span lang="en-US">&nbsp;
</span></font></span><span lang="en-US"><b>mqdel</b></span><span lang="en-US">:
a command to kill multiple jobs with a command, for example </span>
</p>
<p align="center"><font face="Courier"><span lang="en-US">mqdel</span></font>
<font face="Courier"><span lang="en-US">321 100</span></font></p>
<p lang="en-US">The above command will kill 100 jobs back from job
321, that is job with id 321, ..., 222. Find the ids of your jobs
using <b>qstat</b>. 
</p>
<p lang="en-US" align="justify">For more introductions, you can visit
the help page for cluster plato which uses the same scheduling
system: 
</p>
<p align="justify"><span lang="en-US"><a href="http://www.usask.ca/ict/services/research-technologies/advanced-computing/plato/running-jobs.php">http://www.usask.ca/ict/services/research-technologies/advanced-computing/plato/running-jobs.php</a>.
</span>
</p>
<p lang="en-US" align="justify">Note that: You don't know need to
understand the above description to use parallel computing. The
fcommand &quot; <b>qsubR </b>&quot; creates a shell file based on
your R code and submits it to bayes scheduler.</p>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">7.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">Read more about the command qsubR
and mqdel? </span></font></font>
</p>
<p lang="en-US">Type <b>whereis</b> <b>qsubR </b>to find the path to
the file, then you can read the file for details. It has two more
arguments to specify the memory and walltime needed for your jobs.
Using less walltime and less memory than the default settings may
place your jobs in higher priority. 
</p>
<p style="margin-top: 0.42cm; page-break-after: avoid"><font face="Albany, sans-serif"><font size="4" style="font-size: 14pt"><span lang="en-US">8.</span><span style="font-variant: normal"><span lang="en-US">&nbsp;&nbsp;
</span></span><span lang="en-US">Contact</span></font></font></p>
<p class="msonormal">To create account and installing software,
please contact Richard Kondra (<a href="mailto:kondra@math.usask.ca">kondra@math.usask.ca</a>),
with Longhai Li (<a href="mailto:longhai.li@usask.ca">longhai.li@usask.ca</a>)
being c.c.&nbsp; 
</p>

</div>
</body>
</html>
